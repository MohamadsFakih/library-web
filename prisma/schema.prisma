// Personal Media Collection Tracker
// Local: SQLite. For deployment set DATABASE_URL to Postgres (e.g. Vercel Postgres).

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  passwordHash  String?   // null when using SSO (Google/GitHub)
  name          String?
  image         String?
  role          String    @default("USER")  // USER | ADMIN
  disabled      Boolean   @default(false)
  profilePublic Boolean   @default(true)    // whether others can see this user's collection
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  collection   UserMedia[]
  createdMedia Media[]     @relation("MediaCreator")
}

// Media catalog (admin or users add; users add these to their collection)
model Media {
  id          String    @id @default(cuid())
  type        String    // MOVIE | MUSIC | GAME
  title       String
  creator     String    // director, artist, developer
  releaseDate DateTime? // optional release date
  genre       String?
  description String?
  coverUrl    String?
  // Extra metadata: platform (e.g. PS5, Steam), album (for music), etc.
  metadata    String?   // JSON or plain text
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // Who created this entry (null = seeded/system)
  createdById String?
  createdBy   User?     @relation("MediaCreator", fields: [createdById], references: [id], onDelete: SetNull)

  userMedia UserMedia[]
}

// User's collection entry: media + status
model UserMedia {
  id         String   @id @default(cuid())
  userId     String
  mediaId    String
  status     String   // OWNED | WISHLIST | IN_PROGRESS | COMPLETED
  notes      String?
  completedAt DateTime? // when marked completed
  addedAt    DateTime @default(now())

  user  User  @relation(fields: [userId], references: [id], onDelete: Cascade)
  media Media @relation(fields: [mediaId], references: [id], onDelete: Cascade)

  @@unique([userId, mediaId])
  @@index([userId])
  @@index([mediaId])
}
